# HAP 视图插件开发技能

此技能提供创建和开发明道云 HAP 自定义视图插件的完整工作流程。

## 功能概述

- ✅ 安装 mdye-cli 开发工具
- ✅ 初始化唯一的 React 模板项目
- ✅ 自动安装项目依赖
- ✅ 启动开发服务器进行调试
- ✅ 提供项目唯一性保证
- ✅ 包含故障排除指南

## 快速开始

### 方法一：使用完整初始化脚本

```bash
# 进入技能脚本目录
cd ~/.claude/skills/hap-view-plugin/scripts

# 运行完整初始化脚本
./init-hap-view-project.sh
```

### 方法二：手动步骤

1. **检查并安装 mdye-cli**
   ```bash
   # 首先检查是否已安装
   mdye --version

   # 如果未安装，根据系统安装
   # macOS
   sudo npm install -g mdye-cli

   # Windows/Linux
   npm install -g mdye-cli
   ```

2. **创建项目**
   ```bash
   # 生成唯一ID
   ./generate-unique-id.sh

   # 使用生成的ID创建项目
   mdye init view --id 生成的插件ID --template React
   ```

3. **进入项目并安装依赖**
   ```bash
   cd mdye_view_项目后缀
   npm i
   ```

4. **启动开发**
   ```bash
   mdye start
   ```

## 脚本说明

### `generate-unique-id.sh`
生成唯一的插件ID和项目名称。

**用法：**
```bash
./generate-unique-id.sh [前缀]
```

**示例：**
```bash
./generate-unique-id.sh
# 输出：
# 生成的唯一插件ID: 693d2fed8474b99be3d3c12e-1704067200-a1b2c3d4
# 建议的项目目录名: mdye_view_1704067200_a1b2c3d4
```

### `init-hap-view-project.sh`
完整的项目初始化脚本，包含所有步骤。

**用法：**
```bash
./init-hap-view-project.sh [项目名称]
```

**功能：**
1. 检查 Node.js 版本
2. 安装/检查 mdye-cli
3. 生成唯一项目名称和插件ID
4. 创建 React 模板项目
5. 安装项目依赖
6. 显示项目信息和下一步指引

### `quick-start.sh`
快速启动现有项目。

**用法：**
```bash
./quick-start.sh [项目目录]
```

**功能：**
1. 自动查找或指定项目目录
2. 检查项目结构
3. 安装缺失的依赖
4. 启动开发服务器

## 项目结构

初始化后的项目结构：

```
mdye_view_插件后缀/
├── package.json          # 项目配置
├── src/
│   ├── index.jsx        # 插件入口
│   ├── App.jsx          # 主组件
│   └── styles.css       # 样式文件
├── public/
│   └── index.html       # HTML模板
└── README.md            # 项目说明
```

## 开发指南

### 1. 插件开发流程

1. **环境准备**
   - Node.js 16.20+
   - mdye-cli 工具
   - 代码编辑器（VSCode等）

2. **项目创建**
   - 使用唯一插件ID
   - 选择 React 模板
   - 自定义项目名称

3. **开发调试**
   - 启动开发服务器
   - 实时预览效果
   - 热重载支持

4. **构建部署**
   - 生产环境构建
   - 上传到明道云
   - 测试验证

### 2. 代码规范

- 使用 ES6+ 语法
- 遵循 React 最佳实践
- 组件化开发
- 合理的文件组织

### 3. 调试技巧

- 使用浏览器开发者工具
- 查看控制台输出
- 使用 React 开发者工具
- 添加调试日志

## 常见问题

### Q1: Node.js 版本过低
**解决方案：**
- 升级到 Node.js 16.20 或更高版本
- 使用 nvm 管理多版本

### Q2: mdye 命令不存在
**解决方案：**
- 重新安装：`npm install -g mdye-cli`
- 检查 PATH 环境变量
- 重启终端

### Q3: npm 安装失败
**解决方案：**
- 检查网络连接
- 清理缓存：`npm cache clean --force`
- 使用镜像：`npm config set registry https://registry.npmmirror.com`

### Q4: 端口被占用
**解决方案：**
- 关闭占用端口的程序
- 修改开发服务器端口
- 使用不同的端口启动

## 最佳实践

### 1. 项目命名
- 使用有意义的名称
- 包含时间戳保证唯一性
- 避免特殊字符

### 2. 版本控制
- 使用 Git 管理代码
- 编写清晰的提交信息
- 使用分支开发

### 3. 代码质量
- 添加代码检查工具
- 编写单元测试
- 定期重构优化

### 4. 文档维护
- 更新 README
- 编写 API 文档
- 记录配置变更

## 性能优化

### 1. 构建优化
- 代码分割
- 资源压缩
- 缓存策略

### 2. 运行时优化
- 避免不必要的重渲染
- 使用虚拟列表
- 优化状态管理

### 3. 网络优化
- 减少 HTTP 请求
- 使用 CDN
- 数据缓存

## 安全注意事项

### 1. 代码安全
- 避免硬编码敏感信息
- 使用环境变量
- 定期更新依赖

### 2. 数据安全
- 验证用户输入
- 防止 XSS 攻击
- 使用 HTTPS

### 3. 权限控制
- 最小权限原则
- 访问控制检查
- 日志记录

## 更新日志

### v1.0.0
- 初始版本发布
- 包含完整开发工作流程
- 提供三个实用脚本
- 详细的文档说明

## 支持与反馈

如有问题或建议，请：
1. 查看技能文档
2. 参考明道云官方文档
3. 在社区中寻求帮助

---

**注意：** 此技能提供开发工作流程指导，实际开发请根据具体需求调整。